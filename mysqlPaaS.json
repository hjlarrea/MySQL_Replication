    {
        "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
        "contentVersion": "1.0.0.0",
        "parameters": {
            "TrafficManagerName": {
                "type": "string",
                "metadata": {
                    "description":"Name for the Traffic Manager, this value should be unique across all Azure."
                }
            },
            "MySQLServerName": {
                "type": "string",
                "metadata": {
                    "description":"Partial name for the MySQL PaaS, to be completed by the index number of the server, this value should be unique across all Azure."
                }
            },
            "MySQLServerCount":{
                "type": "int",
                "defaultValue": 2,
                "metadata": {
                    "description":"How many MySQL PaaS components to deploy."
                }
            },
            "MySQLServerLocations":{
                "type": "array",
                "defaultValue": ["eastus","westus2"],
                "metadata": {
                    "description":"Locations to which each of the MySQL components will be deployed, define as many locations as instances will be deployed"
                }
            },
            "administratorLogin": {
                "type": "string",
                "metadata": {
                    "description":"Administrator name for MySQL servers."
                }
            },
            "administratorLoginPassword": {
                "type": "securestring",
                "metadata": {
                    "description":"Password for the MySQL server administrator."
                }
            },
            "vCPU": {
                "type": "int",
                "defaultValue": 2,
                "metadata": {
                    "description":"Number of vCPUs for the MySQL Server instances to be deployed."
                }
            },
            "skuFamily": {
                "type": "string",
                "defaultValue": "Gen5",
                "allowedValues": [
                    "Gen4",
                    "Gen5"
                ],
                "metadata": {
                    "description":"Hardware generation for the MySQL Server instances to be deployed."
                }
            },
            "skuSizeMB": {
                "type": "int",
                "defaultValue": 5120,
                "minValue": 5120,
                "metadata": {
                    "description":"Storage capacity for the MySQL Server instances to be deployed."
                }
            },
            "skuTier": {
                "type": "string",
                "defaultValue": "GeneralPurpose",
                "allowedValues": [
                    "Basic",
                    "GeneralPurpose",
                    "MemoryOptimized"
                ],
                "metadata": {
                    "description":"Performance tier for the MySQL Server instances to be deployed."
                }
            },
            "version": {
                "type": "string",
                "defaultValue": "5.7",
                "allowedValues": [
                    "5.6",
                    "5.7"
                ],
                "metadata": {
                    "description":"MySQL version for the MySQL Server instances to be deployed."
                }
            },
            "backupRetentionDays": {
                "type": "int",
                "defaultValue": 7,
                "minvalue": 7,
                "maxvalue": 35,
                "metadata": {
                    "description":"Backup retention period."
                }
            },
            "geoRedundantBackup": {
                "type": "string",
                "defaultValue": "Disabled",
                "allowedValues": [
                    "Enabled",
                    "Disabled"
                ],
                "metadata": {
                    "description":"Enable or disable geo redundant backups."
                }
            }
        },
        "variables": {
            "serverName":"[toLower(parameters('MySQLServerName'))]",
            "skuName": "[concat(if(equals(parameters('skuTier'),'GeneralPurpose'),'GP',if(equals(parameters('skuTier'),'Basic'),'B',if(equals(parameters('skuTier'),'MemoryOptimized'),'MO',''))),'_',parameters('skuFamily'),'_',parameters('vCPU'))]"
        },
        "resources": [
            {
                "apiVersion": "2018-02-01",
                "type": "Microsoft.Network/trafficmanagerprofiles",
                "name": "[parameters('TrafficManagerName')]",
                "location": "global",
                "properties": {
                    "trafficRoutingMethod": "Weighted",
                    "dnsConfig": {
                        "relativeName": "[parameters('TrafficManagerName')]",
                        "ttl": "120"
                    },
                    "monitorConfig": {
                        "protocol": "TCP",
                        "port": 3306,
                        "path": null,
                        "intervalInSeconds": 30,
                        "toleratedNumberOfFailures": 3,
                        "timeoutInSeconds": 10
                    },
                    "endpoints": []
                }
            },
            {
                "apiVersion": "2018-02-01",
                "name": "[concat(parameters('TrafficManagerName'),'/',parameters('MySQLServerName'),add(copyindex(),1))]",
                "type": "Microsoft.Network/trafficManagerProfiles/externalEndpoints",
                "location": "global",
                "dependsOn": [
                    "[concat('Microsoft.Network/trafficManagerProfiles/',parameters('TrafficManagerName'))]"
                ],
                "properties": {
                    "endpointStatus": "Enabled",
                    "target": "[concat(parameters('MySQLServerName'),add(copyindex(),1),'.mysql.database.azure.com')]",
                    "weight": 1,
                    "priority": "[add(copyindex(),1)]",
                    "endpointLocation": null
                },
                "copy": {
                    "name": "ExternalEndpointsLoop",
                    "count": "[parameters('MySQLServerCount')]"
                }
            },
            {
                "type": "Microsoft.DBforMySQL/servers",
                "apiVersion": "2017-12-01-preview",
                "kind": "",
                "location": "[parameters('MySQLServerLocations')[copyindex()]]",
                "name": "[concat(variables('serverName'),add(copyindex(),1))]",
                "copy": {
                    "name": "MySQLServerLoop",
                    "count": "[parameters('MySQLServerCount')]"
                },
                "properties": {
                    "version": "[parameters('version')]",
                    "administratorLogin": "[parameters('administratorLogin')]",
                    "administratorLoginPassword": "[parameters('administratorLoginPassword')]",
                    "storageProfile": {
                        "storageMB": "[parameters('skuSizeMB')]",
                        "backupRetentionDays": "[parameters('backupRetentionDays')]",
                        "geoRedundantBackup": "[parameters('geoRedundantBackup')]"
                    },
                    "sslEnforcement": "Enabled"
                },
                "sku": {
                    "name": "[variables('skuName')]",
                    "tier": "[parameters('skuTier')]",
                    "capacity": "[parameters('vCPU')]",
                    "size": "[parameters('skuSizeMB')]",
                    "family": "[parameters('skuFamily')]"
                },
                "resources": [
                    {
                        "apiVersion": "2017-12-01-preview",
                        "type": "firewallRules",
                        "location": "[parameters('MySQLServerLocations')[copyindex()]]",
                        "name": "AllowAzureResources",
                        "properties": {
                            "startIpAddress": "0.0.0.0",
                            "endIpAddress": "0.0.0.0"
                        },
                        "dependsOn": [
                            "[concat('Microsoft.DBforMySQL/servers/', variables('serverName'),add(copyindex(),1))]"
                        ]
                    }
                ]
            }
        ]
    }